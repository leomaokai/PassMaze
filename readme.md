# 迷宫通行

## 摘要

**迷宫通行**输入任意大小的迷宫，控制小人设置起点、终点、障碍。按下演示按键后，在屏幕上显示出一条走出迷宫的路径。

使用到的图形库:   [EasyX 2020版](https://easyx.cn/downloads/)

开发环境:   Windows 10 

开发工具:   Visual Studio 2019

源码地址: [leomaokai/PassMaze](https://github.com/leomaokai/MyCpp)(未改)

## 功能要求

* 输入任意大小的迷宫,任设起点,终点,障碍,用栈求出一条迷宫路径,并显示在屏幕上
* 根据用户界面提示，用键盘输入。home键设置迷宫起点，end键设终点，上下左右箭头键移动，enter键添加墙，del键删除墙，完成后按F9键演示，Esc键退出。(为了方便操作与键盘兼容,a键设置起点,s键设终点,w键添加墙,q键删除墙,e键开始演示)
* 橙色的实心小圆圈表示起点，绿色实心圆圈表示终点，空心圆圈表示足迹，红色方块表示墙。
*  未设起点或终点时，会显示“error”，找到路径时，屏幕显示足迹，并在消息框出现Path found，否则消去足迹，显示Path not found.

## 功能演示

* 输入一个8*8大小的迷宫
  * ![](img\01.png)
  * ![](img\02.png)
* 通过按 i k j l  控制小人设置迷宫,橙色的实心小圆圈表示起点，绿色实心圆圈表示终点，红色方块表示墙
  * ![](img\03.png)
* 设置好迷宫后,按 e 键演示迷宫路径，空心圆圈表示足迹
  * ![](img\05.png)

* 其余出错功能(未设起点或终点,无路径)等不一一演示(下载源码自行测试)

## 原理框图

### 整体框图

![](img\06.png)

### 设置迷宫框图

![](C:\Users\LEOMESSI\Desktop\PassMaze\img\07.png)

### DFS框图

![](img\08.png)

## 代码模块

### 存储结构

![](img\29.png)

![](img\28.png)

### 迷宫初始化

* 设置迷宫大小
  * ![](img\09.png)
* 绘制外墙与格子
  * ![](img\10.png)
* 绘制提示信息
  * ![](img\11.png)
* 初始化小人位置与墙数组
  * ![](img\12.png)

### 设置迷宫

* 小人上下左右移动
  * ![](img\13.png)
  * ![](img\14.png)
    * 此函数记录了人小移动前位置以及其四个方向的的颜色,黄色为起点,绿色为终点,红色为墙,小人利用图片覆盖的方式移动,若没有记录,会将其覆盖,所以得在移动前记录标记的,移动后进行恢复
  * ![](img\15.png)
* 设置墙
  * ![](img\16.png)
* 删除墙或起点终点
  * ![](img\17.png)
* 设置起点和终点
  * ![](img\18.png)

### 通行迷宫

* 移动小人到起点位置,将起点入栈
  * ![](img\19.png)
* 用栈进行深度优先遍历(核心代码)
  * ![](img\20.png)
* 打印路径
  * ![](img\21.png)

## 算法改进

### DFS转BFS

DFS的缺点:有多条路径时,无法得到最短路径

![](img\24.png)

使用BFS可以得到最短路径,但BFS需要使用额外的一个数组记录路径节点

* `vector`数组记录了每一个节点在BFS过程中的前驱节点
  * ![](img\25.png)
* BFS核心代码
  * ![](img\26.png)
* 测试结果,得到最短路径
  * ![](img\27.png)

## 遇到的问题及解决方案

在最开始定义数组节点时,没有记录节点的4个方向,那么如何在深度优先遍历中每个节点都是从同一个方向开始判断?

* 第一两个方向数组,通过加这两个数组的方式得到其四个方向的坐标
  * ![](img\22.png)

写完DFS后无法测试成功,通过调试DFS部分发现死循环,后发现错误原因是墙数组`wall[x][y]`与绘图过程中小人坐标的`(x,y)`并不对应,墙数组`wall[y][x]`才与小人坐标`(x,y)`对应

* 修改所有墙数组与小人坐标的对应方式
* ![](img\23.png)